plugins {
    id 'idea'
    id 'maven-publish'
    // Use common Gradle settings for Java libraries defined in conventions plugin:
    // /buildSrc/src/main/groovy/terra-cloud-resource-lib.library-conventions.gradle
    id 'terra-cloud-resource-lib.library-conventions'

    id 'com.jfrog.artifactory' version '4.13.0'
}

def artifactory_repo_key = System.getenv("ARTIFACTORY_REPO_KEY") != null ? System.getenv("ARTIFACTORY_REPO_KEY") : 'libs-snapshot-local'
def artifactory_username = System.getenv('ARTIFACTORY_USERNAME')
def artifactory_password = System.getenv('ARTIFACTORY_PASSWORD')

gradle.taskGraph.whenReady { taskGraph ->
    if (taskGraph.hasTask(artifactoryPublish) &&
            (artifactory_username == null || artifactory_password == null)) {
        throw new GradleException("Set env vars ARTIFACTORY_USERNAME and ARTIFACTORY_PASSWORD to publish")
    }
}

dependencies {
    implementation group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.12.3'
    implementation group: 'com.fasterxml.jackson.datatype', name: 'jackson-datatype-jdk8', version: '2.12.3'
    implementation group: 'com.fasterxml.jackson.datatype', name: 'jackson-datatype-jsr310', version: '2.12.3'
    implementation group: 'com.google.cloud', name: 'google-cloud-pubsub'
    implementation group: 'io.opencensus', name: 'opencensus-api', version: '0.28.3'
    implementation group: 'io.opencensus', name: 'opencensus-impl', version: '0.28.3'

    api group: 'com.azure', name: 'azure-identity', version: '1.4.3'
    api group: 'com.azure', name: 'azure-core', version: '1.24.1'
    api group: 'com.azure.resourcemanager', name: 'azure-resourcemanager-resources', version: '2.10.0'

    testFixturesImplementation group: 'bio.terra', name: 'terra-resource-janitor-client', version: janitorclient
    testFixturesImplementation group: 'com.azure', name: 'azure-core', version: '1.24.1'
    testFixturesImplementation group: 'com.azure.resourcemanager', name: 'azure-resourcemanager-resources', version: '2.10.0'
    testFixturesImplementation group: 'org.mockito', name: 'mockito-core', version: '3.6.0'

    testImplementation group: 'com.google.cloud', name: 'google-cloud-resourcemanager'

}
